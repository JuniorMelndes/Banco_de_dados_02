CREATE OR REPLACE TYPE DEPARTMENTS_OBJ AS OBJECT(
    DEPARTMENT_ID NUMBER,
    DEPARTMENT_NAME VARCHAR2(30),
    MANAGER_ID NUMBER,
    LOCATION_ID NUMBER
);

CREATE TABLE DEPARTMENTS_TAB OF DEPARTMENTS_OBJ;

ALTER TABLE DEPARTMENTS_TAB ADD CONSTRAINT PK_DEPART_ID PRIMARY KEY (DEPARTMENT_ID);

INSERT INTO DEPARTMENTS_TAB SELECT * FROM OEHR_DEPARTMENTS;

ALTER TYPE DEPARTMENTS_OBJ ADD STATIC FUNCTION conta_dep RETURN INTEGER CASCADE;

CREATE OR REPLACE TYPE BODY DEPARTMENTS_OBJ AS
    STATIC FUNCTION conta_dep RETURN INTEGER
    IS
    dept_out_manager INTEGER;
    BEGIN
        SELECT COUNT(*) INTO dept_out_manager FROM DEPARTMENTS_TAB WHERE MANAGER_ID IS NULL;
        RETURN dept_out_manager;
    END;
END;

SELECT DEPARTMENTS_OBJ.conta_dep() AS "Departamentos sem gerentes" FROM DUAL;