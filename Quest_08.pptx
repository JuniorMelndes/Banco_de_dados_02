CREATE TYPE LIDER_TYPE AS OBJECT(
    codigo  INTEGER,
    nome    VARCHAR2(30)
);

CREATE TABLE LIDER_TAB OF LIDER_TYPE(
    PRIMARY KEY (codigo)
);

INSERT INTO LIDER_TAB VALUES(10, 'José');
INSERT INTO LIDER_TAB VALUES(20, 'Maria');

CREATE TYPE INTEGRANTE_TYPE AS OBJECT(
    codigo  INTEGER,
    nome    VARCHAR2(30),
    lider   REF LIDER_TYPE
);

CREATE TABLE INTEGRANTE_TAB OF INTEGRANTE_TYPE(
    CONSTRAINT codigo_pk PRIMARY KEY (codigo),
    CONSTRAINT lider_fK FOREIGN KEY (lider) REFERENCES LIDER_TAB
);

INSERT INTO INTEGRANTE_TAB VALUES(100, 'Pedro', (SELECT REF(E) FROM LIDER_TAB E WHERE E.codigo = 10));
INSERT INTO INTEGRANTE_TAB VALUES(200, 'Paula', (SELECT REF(E) FROM LIDER_TAB E WHERE E.codigo = 20));
INSERT INTO INTEGRANTE_TAB VALUES(300, 'Marta', (SELECT REF(E) FROM LIDER_TAB E WHERE E.codigo = 20));

SELECT i.nome, i.lider.nome FROM INTEGRANTE_TAB i;

CREATE TYPE INTEGRANTE_TYPE2 AS OBJECT(
    codigo  INTEGER,
    nome    VARCHAR2(30)
);

CREATE TYPE INTEGRANTES_TYPE AS TABLE OF INTEGRANTE_TYPE2;

CREATE TYPE LIDER_TYPE2 AS OBJECT(
    codigo      INTEGER,
    nome        VARCHAR2(30),
    integrantes INTEGRANTES_TYPE
);

CREATE TABLE LIDER_TAB2 OF LIDER_TYPE2(
    CONSTRAINT codigo_pk2 PRIMARY KEY (codigo)
)NESTED TABLE integrantes STORE AS nt_integrantes_tab;

INSERT INTO LIDER_TAB2 VALUES(10, 'José', INTEGRANTES_TYPE(INTEGRANTE_TYPE2(100, 'Pedro')));

INSERT INTO LIDER_TAB2 VALUES(20, 'Maria', INTEGRANTES_TYPE(INTEGRANTE_TYPE2(200, 'Marta'), INTEGRANTE_TYPE2(300, 'Paula')));

SELECT l.nome, i.nome FROM LIDER_TAB2 l, TABLE(l.integrantes) i;

